@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Web
@using SeamLessGoWeb.Services.Interfaces
@using SeamLessGoWeb.Services.Auth
@using SeamLessGoWeb.Data
@using SeamLessGoWeb.Components.Layout
@using SeamLessGoWeb.Models
@page "/tax-visible-transactions"
@inject ITransactionService TransactionService

<h2 class="page-title">Visible Tax Transactions</h2>

<div class="transactions-container">
    <table class="transactions-table">
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>Customer</th>
                <th>Employee</th>
                <th>Net</th>
                <th>Total</th>
                <th>Remaining</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            @if (Transactions == null)
            {
                <tr><td colspan="9">Loading...</td></tr>
            }
            else
            {
                @foreach (var t in Transactions)
                {
                    <tr>
                        <td>@t.TransactionID</td>
                        <td>@t.CustomerName</td>
                        <td>@t.EmployeeName</td>
                        <td>@t.NetAmount</td>
                        <td>@t.TotalAmount</td>
                        <td>@t.RemainingAmount</td>
                        <td>@(t.IsVoided ? "Voided" : "Active")</td>
                        <td>@t.TransactionDate.ToShortDateString()</td>

                        <td>
                            <button class="btn-void" @onclick="() => VoidTransaction(t.TransactionID)">Void</button>
                            <button class="btn-print" @onclick="() => PrintTransaction(t.TransactionID)">Print</button>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@code {
    List<TransactionListModel> Transactions;

    protected override async Task OnInitializedAsync()
    {
        Transactions = await TransactionService.GetVisibleTransactionsAsync();
    }

    async Task VoidTransaction(string id)
    {
        await TransactionService.VoidTransaction(id);
        Transactions = await TransactionService.GetVisibleTransactionsAsync();
    }

    void PrintTransaction(string id)
    {
        // PDF or printer service later
        Console.WriteLine($"Printing {id}");
    }
}
